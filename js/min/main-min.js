var templates={result:'<div class="results__item" data-id="{id}"><header><div class="item__trip"> {description} </div><div class="mdl-layout-spacer"></div><time>{time} min</time><button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored" data-upgraded=",MaterialButton"><i class="material-icons">expand_more</i></button></header><div class="item__details"><ul> <span>Cargando detalles...</span> </ul><div class="item__action"><a class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored btn-block btn-with-icon" href="#" data-upgraded=",MaterialButton"><i class="mdl-icon-toggle__label material-icons">place</i> Ver recorrido en el mapa </a></div></div></div>'},ui={trip:{gpsLoding:function(e){$("#trip-"+e).parent().addClass("loading")},stopLoding:function(e){$("#trip-"+e).parent().removeClass("loading")},set:function(e,t){$("#trip-"+e).val(t)}},autocompleter:{toggleResults:function(e){var t=$(".autocomplete-"+e+" .usig_acv");t.removeClass("hidden"),t.is(":visible")?t.next().addClass("hidden"):t.addClass("hidden").next().removeClass("hidden")},select:function(e,t){$("#trip-"+t).val(renderName(e.toString())),ui.autocompleter.close()},close:function(){$("body").removeClass("show-autocomplete-to show-autocomplete-from")}}},renderName=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},autocompleter={setup:function(e){return new usig.AutoCompleter("autocomplete-"+e,{skin:"custom",idOptionsDiv:"autocomplete-"+e+"__container",hideOnBlur:!1,afterSuggest:function(){ui.autocompleter.toggleResults(e)},onInputChange:function(){ui.autocompleter.toggleResults(e)},afterSelection:function(t){t instanceof usig.Direccion||t instanceof usig.inventario.Objeto?(trip[e]=t,ui.autocompleter.select(t,e)):console.log("Something went wrong with the selected place")},afterGeoCoding:function(t){t instanceof usig.Punto&&trip[e]instanceof usig.Direccion&&(trip[e].setCoordenadas(t),trip.calculate())}})}};autocompleter.from=autocompleter.setup("from"),autocompleter.to=autocompleter.setup("to");var geolocation={_setup:function(){"geolocation"in navigator?geolocation.works=!0:(geolocation.works=!1,console.log("no geolocation for u my friend :("))},set:function(e){if(geolocation.works){ui.trip.gpsLoding(e);var t=new usig.GeoCoder;navigator.geolocation.getCurrentPosition(function(o){t.reverseGeoCoding(o.coords.longitude,o.coords.latitude,function(t){trip[e]=new usig.Punto(t.puerta_x,t.puerta_y),ui.trip.set(e,renderName(t.calle_alturas)),ui.trip.stopLoding(e),$("#autocomplete-"+e).val(t.calle_alturas),trip.calculate()},function(t){ui.trip.stopLoding(e),console.log(t)})},function(){ui.trip.stopLoding(e)})}}};geolocation._setup(),geolocation.set("from");var trip={calculate:function(){if(trip.from&&trip.to){$(".results").removeClass("blank").addClass("loading");var e={opciones_medios_colectivo:$("#config-bus").is(":checked"),opciones_medios_subte:$("#config-subway").is(":checked"),opciones_medios_tren:$("#config-train").is(":checked"),opciones_caminata:$("#config-walk").val()};usig.Recorridos.buscarRecorridos(trip.from,trip.to,trip._renderResults,trip._renderError,e)}else console.log("Ingrese origen y destino del recorrido.")},_renderError:function(){console.log("Se produjo un error el buscar el recorrido.")},_renderResults:function(e){trip.results=e,$(".results .results__item").remove();for(var t=0;t<e.length;t++){var o=templates.result;o=o.replace(/\{id\}/gi,t).replace(/\{description\}/gi,e[t].toHtmlString()).replace(/\{time\}/gi,e[t].getTime()),$(".results .results-items").append(o)}$(".results").removeClass("loading")}};$(".results").on("tap",".results__item:not([data-loaded]) header",function(){var e=$(this).parent().data("id"),t="";trip.results[e].getDetalle(function(o){for(var a=0;a<o.length;a++)t+='<li><i class="mdl-icon-toggle__label material-icons '+o[a].type+'"></i><div>'+o[a].text+"</div></li>";$("[data-id="+e+"] ul").html(t),$("[data-id="+e+"]").attr("data-loaded",!0)},function(){$("[data-id="+e+"] ul").html("No se pudieron cargar los detalles.")})}),$(window).load(function(){$("#cl-loading").addClass("hidden")}),$("#cl-onboard a").on("tap",function(e){$("#cl-onboard").addClass("hidden"),$("#cl-form").removeClass("hidden"),e.preventDefault()}),$(".trip-form").on("tap",".js-trip_options:not([disabled])",function(e){$(this).toggleClass("open"),$(".trip-settings").toggleClass("open"),e.preventDefault()}),$(".button-toggle input").on("change",function(){"bus"===$(this).val()?$(".js-trip_options").removeAttr("disabled"):($(".js-trip_options").attr("disabled",!0),$(".trip-settings, .js-trip_options").removeClass("open"))}),$(".trip-settings input.mdl-slider").on("touchmove change",function(){$(".walkMax").text($(this).val())}),$(".results").on("tap","header",function(e){$(this).parent().toggleClass("open"),e.preventDefault()}),$(".trip-form__row .pale-textfield #trip-from").on("focus",function(e){$(this).blur(),$("body").addClass("show-autocomplete-from"),$("#autocomplete-from").focus().select(),$(".autocomplete-from .usig_acv").addClass("hidden").next().removeClass("hidden"),e.preventDefault()}),$(".trip-form__row .pale-textfield #trip-to").on("focus",function(e){$(this).blur(),$("body").addClass("show-autocomplete-to"),$("#autocomplete-to").focus().select(),$(".autocomplete-to .usig_acv").addClass("hidden").next().removeClass("hidden"),e.preventDefault()}),$(".js-autocomplete_close").on("tap",function(e){$("body").removeClass("show-autocomplete-to show-autocomplete-from"),e.preventDefault()}),$(".js-autocomplete_clear").on("tap",function(e){$(this).prev().find("input").val("").focus(),e.preventDefault()}),$("#cl-autocomplete input").on("keyup",function(e){13===e.keyCode&&$(this).blur()}),$(".autocomplete-from__gps").on("tap",function(e){geolocation.set("from"),ui.autocompleter.close(),e.preventDefault()}),$(".autocomplete-to__gps").on("tap",function(e){geolocation.set("to"),ui.autocompleter.close(),e.preventDefault()}),$(".autocomplete-from .location-autocomplete li a, .autocomplete-to .location-autocomplete li a").on("click",function(e){e.preventDefault()}),$(".js-favourites_trigger").on("tap",function(e){$("body").addClass("show-favourites"),e.preventDefault()}),$(".js-favourites_close, .js-fav-from, .js-fav-to").on("tap",function(e){$("body").removeClass("show-favourites"),e.preventDefault()}),$(".js-favourites__clear").on("tap",function(e){$(this).prev().val("").focus(),e.preventDefault()}),$(".js-fav-map, #cl-map .search-scroll .options li a").on("tap",function(e){$(".map-marker").removeClass("hidden"),$("body").addClass("show-map"),$("#cl-map").removeClass("show-search"),e.preventDefault()}),$(".js-fav-rename").on("tap",function(e){$(this).parent().parent().prev().addClass("rename").find("input").focus(),e.preventDefault()}),$(".js-fav-rename__cancel").on("tap",function(e){$(this).parent().parent().parent().removeClass("rename"),e.preventDefault()}),$(".fav-rename").on("submit",function(e){$(this).parent().removeClass("rename"),$(this).prev().find("small").text("CABA - "+$(this).find("input").val()),$(this).find("input").blur(),e.preventDefault()}),$(".fav-rename input").on("keyup",function(e){13===e.keyCode&&$(".fav-rename").submit()}),$(".js-fav-clear").on("tap",function(e){$(".fav-list > ul").empty(),$("#delete-favourites").attr("disabled",!0),e.preventDefault()}),$(".fav-list li a, .history-list li a").on("tap",function(e){$(this).focus(),e.preventDefault()}),$(".js-history_trigger").on("tap",function(e){$("body").addClass("show-history"),e.preventDefault()}),$(".js-history_close").on("tap",function(e){$("body").removeClass("show-history"),e.preventDefault()}),$(".js-history-repeat").on("tap",function(e){$("body").removeClass("show-history"),e.preventDefault()}),$(".js-history-clear").on("tap",function(e){$(".history-list > ul").empty(),$("#delete-history").attr("disabled",!0),e.preventDefault()}),$(".js-info_trigger").on("tap",function(e){$("body").addClass("show-info"),e.preventDefault()}),$(".js-info_close").on("tap",function(e){$("body").removeClass("show-info"),e.preventDefault()}),$("body").on("tap",".js-map_trigger, .item__action a",function(e){$("body").addClass("show-map"),e.preventDefault()}),$(".js-map_close").on("tap",function(e){$("body").removeClass("show-map"),$(".map-marker").addClass("hidden"),e.preventDefault()}),$(".map-container .location-button").on("tap",function(e){$(this).toggleClass("active"),$(".map-container .locator").toggleClass("show"),e.preventDefault()}),$(".map-marker .leaflet-popup-close-button").on("tap",function(e){$(".map-marker").addClass("hidden"),e.preventDefault()}),$(".js-map-from, .js-map-to").on("tap",function(e){$("body").removeClass("show-map show-favourites"),$(".map-marker").addClass("hidden"),e.preventDefault()}),$(".js-mapsearch_trigger").on("tap",function(e){$("#cl-map").addClass("show-search"),setTimeout(function(){$("#cl-map .map-search input").focus()},100),e.preventDefault()}),$(".js-mapsearch_close").on("tap",function(e){$("#cl-map").removeClass("show-search"),e.preventDefault()}),$(".js-mapsearch_clear").on("tap",function(e){$("#cl-map .map-search input").val("").focus(),e.preventDefault()}),$("#cl-map .map-search input").on("keyup",function(e){13===e.keyCode&&$(this).blur()});