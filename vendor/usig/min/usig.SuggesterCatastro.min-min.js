"undefined"==typeof usig&&(usig={}),usig.AjaxComponent=function(t){return jQuery.Class.create({init:function(e,s,i){this.name=e;var n=i.dataType||(window.location.host==usig.parseUri(s).authority?"json":"jsonp");this.defaultParams={type:"GET",url:s,dataType:n},this.opts=t.extend({},usig.AjaxComponent.defaults,i),this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") dataType: "+n)},mkRequest:function(e,s,i,n){function a(t,e){clearTimeout(r),this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success"),"function"==typeof this.opts.afterServerResponse&&(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse"),this.opts.afterServerResponse()),e(t)}function o(t,e){this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error"),g>=this.opts.maxRetries?(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Max Errors Reached"),clearTimeout(r),"function"==typeof e&&e(t)):this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Error. Retrying... ("+g+")")}function u(e,s){if(null!=e&&0!=e.readyState&&4!=e.readyState)if(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Aborting request..."),e.abort(),"function"==typeof this.opts.afterAbort&&(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort"),this.opts.afterAbort()),this.opts.maxRetries>g){g++;var i=t.ajax(s);"function"==typeof this.opts.afterRetry&&(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry"),this.opts.afterRetry()),this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") Retrying request... ("+g+")"),r=setTimeout(u.createDelegate(this,[i,h]),this.opts.serverTimeout)}else this.opts.debug&&usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito."),"function"==typeof s.error&&s.error("Se produjo un error al intentar acceder al servidor: "+s.url)}var r=null,g=0;if("function"!=typeof s)return void(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una función que acepte como parámetro el dato solicitado porque puede no estar inmediatamente disponible."));if("undefined"!=typeof i&&"function"!=typeof i)return void(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una función."));var h=t.extend(!0,{},this.defaultParams,{success:a.createDelegate(this,[s],1),error:o.createDelegate(this,[i],1),data:e});n&&(h.url=n);var c=t.ajax(h);return this.opts.debug&&usig.debug(h.dataType+" request..."),"function"==typeof this.opts.afterServerRequest&&(this.opts.debug&&usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest"),this.opts.afterServerRequest()),this.opts.serverTimeout>0&&(r=setTimeout(u.createDelegate(this,[c,h]),this.opts.serverTimeout)),c},setOptions:function(e){this.opts=t.extend({},this.opts,e)},getOptions:function(){return this.opts}})}(jQuery),usig.AjaxComponent.defaults={debug:!1,serverTimeout:3e4,maxRetries:1},"undefined"==typeof usig&&(usig={}),usig.Punto=function(t,e){this.x=this.lon=t,this.y=this.lat=e,this.getX=function(){return this.x},this.getY=function(){return this.y},this.toJson=function(){return'{ "x":'+this.x+', "y": '+this.y+" }"},this.toString=function(){return"("+this.x+", "+this.y+")"}},usig.Punto.fromWkt=function(t){var e=/^POINT *\(([0-9]+\.[0-9]+) ([0-9]+\.[0-9]+)\)$/,s=null;return(resMatch=t.match(e))&&(s=new usig.Punto(resMatch[1],resMatch[2])),s},usig.Punto.fromPunto=function(t){return new usig.Punto(t.getX(),t.getY())},usig.Punto.fromObj=function(t){return new usig.Punto(t.x,t.y)},"undefined"==typeof usig&&(usig={}),usig.SeccionCatastral=function(t){this.codigoSeccion=t,this.descripcion="Código Sección",this.toString=function(){return this.codigoSeccion}},"undefined"==typeof usig&&(usig={}),usig.ManzanaCatastral=function(t){this.codigoManzana=t,this.descripcion="Código Sección-Manzana",this.toString=function(){return this.codigoManzana}},"undefined"==typeof usig&&(usig={}),usig.ParcelaCatastral=function(t){this.smp=t.smp,this.pm=t.pm,this.punto=usig.Punto.fromWkt(t.centroide),""!=this.pm?this.descripcion="Código Partida-Matriz":this.descripcion="Código Sección-Manzana-Parcela",this.getPunto=function(){return this.punto},this.toString=function(){return""!=this.pm?this.pm:this.smp}},"undefined"==typeof usig&&(usig={}),usig.IndiceCatastral=function(t){return usig.AjaxComponent.extend({init:function(e){var s=t.extend({},usig.IndiceCatastral.defaults,e);this._super("IndiceCatastral",usig.IndiceCatastral.defaults.server,s),this.showDebug("Creando instancia de usig.IndiceCatastral")},buscar:function(t,e,s,n){function a(t,e,s){var n=[],s=Math.min(t.datos.length,s);for(i=0;i<s;i++)"P"==t.tipo?n.push(new usig.ParcelaCatastral(t.datos[i])):"M"==t.tipo?n.push(new usig.ManzanaCatastral(t.seccion+"-"+t.datos[i])):"S"==t.tipo&&n.push(new usig.SeccionCatastral(t.datos[i]));this.showDebug(n),"function"==typeof e&&e(n)}var o=/^([0-9]{2})-([0-9]{3}[A-Z]?)-([A-Z0-9]{0,5})$/,u=/^([0-9]{2})-([0-9]{0,3}|[0-9]{3}[A-Z])$/,r=/^([0-9]{1,6})$/,g=/^([0-9]{1,2})$/,h=/^([1-9][0-9]{0,5})$/,t=t.toUpperCase(),n=void 0!=n?n:this.opts.maxSuggestions;if(this.showDebug("-=-=-= Busqueda: "+t+" =-=-=-"),(resMatch=t.match(o))&&this.opts.buscarSMP)this.lastRequest=this.mkRequest(null,a.createDelegate(this,[e,n],1),s,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2]+"/"+resMatch[3]);else if((resMatch=t.match(u))&&this.opts.buscarSMP)this.lastRequest=this.mkRequest(null,a.createDelegate(this,[e,n],1),s,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2]);else if(resMatch=t.match(r)){var c=!1;if(t.match(h)&&this.opts.buscarPM&&(this.lastRequest=this.mkRequest(null,a.createDelegate(this,[e,n],1),s,this.opts.server+"pm/"+resMatch[1]),c=!0),t.match(g)&&this.opts.buscarSMP&&(this.lastRequest=this.mkRequest(null,a.createDelegate(this,[e,n],1),s,this.opts.server+"smp/"+resMatch[1]),c=!0),!c)throw new usig.IndiceCatastral.WrongParameters}else{if(""!=t||!this.opts.buscarSMP)throw new usig.IndiceCatastral.WrongParameters;this.lastRequest=this.mkRequest(null,a.createDelegate(this,[e,n],1),s,this.opts.server+"smp/")}},abort:function(){this.lastRequest&&(this.lastRequest.abort(),this.lastRequest=null,"function"==typeof this.opts.afterAbort&&this.opts.afterAbort())},showDebug:function(t){this.opts.debug&&usig.debug(t)}})}(jQuery),usig.IndiceCatastral.WrongParameters=function(){this.msg="Los parametros ingresados son incorrectos.",this.getErrorMessage=function(){return this.msg}},usig.IndiceCatastral.defaults={debug:!1,server:"http://inventario.usig.buenosaires.gob.ar/indice_catastral/",maxSuggestions:10,buscarSMP:!0,buscarPM:!0},"undefined"==typeof usig&&(usig={}),usig.SuggesterCatastro=function(t){return usig.Suggester.extend({init:function(e){var s=t.extend({},usig.SuggesterCatastro.defaults,e);this._super("Catastro",s),this.opts.indiceCatastral||(this.opts.indiceCatastral=new usig.IndiceCatastral(s),this.cleanList.push(this.opts.indiceCatastral)),s.onReady&&"function"==typeof s.onReady&&s.onReady()},getSuggestions:function(t,e,s){var i=void 0!=s?s:this.opts.maxSuggestions;try{this.opts.indiceCatastral.buscar(t,e,function(){},i)}catch(n){e(n)}},getGeoCoding:function(t,e){e(t instanceof usig.ParcelaCatastral?t.getPunto():new usig.Suggester.GeoCodingTypeError)},abort:function(){this.opts.indiceCatastral.abort()},ready:function(){return!0},setOptions:function(t){this._super(t),this.opts.indiceCatastral.setOptions(t)}})}(jQuery),usig.SuggesterCatastro.defaults={debug:!1,serverTimeout:5e3,maxRetries:5,maxSuggestions:10},usig.registerSuggester("Catastro",usig.SuggesterCatastro);